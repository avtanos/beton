# Описание бизнес-процессов АСУ ТП Бетонного завода

## 1. Общий бизнес-процесс производства бетона

### 1.1 Жизненный цикл заказа

```
┌─────────────┐
│  Получение  │
│   заказа    │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ Планирование│
│  производства│
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  Создание   │
│   партии    │
└──────┬──────┘
       │
       ▼
┌─────────────┐      ┌─────────────┐      ┌─────────────┐
│ Дозирование│ ───▶ │Перемешивание│ ───▶ │  Выгрузка   │
└─────────────┘      └─────────────┘      └──────┬──────┘
                                                   │
                                                   ▼
                                            ┌─────────────┐
                                            │   Качество  │
                                            │  (лаборатория)│
                                            └──────┬──────┘
                                                   │
                                                   ▼
                                            ┌─────────────┐
                                            │  Отгрузка   │
                                            └─────────────┘
```

### 1.2 Детальное описание этапов

#### Этап 1: Получение и регистрация заказа
- **Участники**: Логист/диспетчер, Оператор
- **Входные данные**: 
  - Марка бетона
  - Объем (м³)
  - Время доставки
  - Адрес доставки
  - Данные заказчика
- **Процесс**:
  1. Логист принимает заказ (телефон, CRM, лично)
  2. Создает заказ в системе
  3. Выбирает рецептуру по марке бетона
  4. Назначает транспорт
  5. Заказ получает статус "Ожидает"
- **Выходные данные**: Заказ с номером, статусом, привязкой к рецептуре

#### Этап 2: Планирование производства
- **Участники**: Оператор, Мастер смены
- **Процесс**:
  1. Оператор просматривает очередь заказов
  2. Проверяет наличие сырья на складе
  3. Планирует последовательность производства
  4. Учитывает время доставки
- **Проверки**:
  - Достаточно ли сырья для заказа
  - Свободен ли смеситель
  - Доступен ли транспорт

#### Этап 3: Создание производственной партии
- **Участники**: Оператор
- **Процесс**:
  1. Оператор создает партию из заказа
  2. Система автоматически привязывает рецептуру
  3. Рассчитывает необходимое количество компонентов
  4. Партия получает статус "Запланирована"

#### Этап 4: Дозирование компонентов (IoT + AI)
- **Участники**: Оператор, Автоматизированная система
- **Продолжительность**: 3-5 минут
- **Процесс**:
  1. Оператор запускает производство партии
  2. Система переводит партию в статус "Дозирование"
  3. **IoT датчики** контролируют:
     - Вес компонентов на весах
     - Уровень заполнения силосов/бункеров
     - Влажность инертных материалов
  4. **AI система**:
     - Корректирует количество воды с учетом влажности песка/щебня
     - Предсказывает отклонения и предупреждает оператора
     - Оптимизирует последовательность дозирования
  5. Компоненты дозируются по очереди:
     - Цемент (из силоса через шнек)
     - Песок (из бункера через конвейер)
     - Щебень (из бункера через конвейер)
     - Вода (из емкости)
     - Добавки (из дозаторов)
  6. После каждого компонента:
     - Фиксируется фактический вес
     - Рассчитывается отклонение от рецепта
     - Если отклонение > допустимого (±2% для инертных, ±1% для цемента/воды) - предупреждение
  7. Оператор подтверждает завершение дозирования
- **Точность**: 
  - Инертные материалы: ±2%
  - Цемент: ±1%
  - Вода: ±1%
  - Добавки: ±0.5%

#### Этап 5: Перемешивание
- **Участники**: Автоматизированная система
- **Продолжительность**: 2-3 минуты (задается в рецепте)
- **Процесс**:
  1. После завершения дозирования компоненты загружаются в смеситель
  2. Система автоматически запускает смеситель
  3. **IoT датчики** контролируют:
     - Мощность двигателя смесителя
     - Температуру смеси
     - Время перемешивания
  4. **AI система**:
     - Анализирует энергопотребление (аномалии = проблемы)
     - Корректирует время перемешивания в зависимости от температуры
  5. По истечении времени система переводит в статус "Выгрузка"

#### Этап 6: Выгрузка в миксер
- **Участники**: Оператор, Водитель
- **Продолжительность**: 1-2 минуты
- **Процесс**:
  1. Смеситель выгружает готовый бетон в миксер автомобиля
  2. **IoT датчики**:
     - Контролируют вес выгруженного бетона
     - Фиксируют номер машины
  3. Система переводит партию в статус "Завершена"
  4. Формируется паспорт бетона

#### Этап 7: Контроль качества (AI)
- **Участники**: Лаборант
- **Процесс**:
  1. Лаборант берет пробу из партии
  2. Проводит испытания:
     - Подвижность (конус Абрамса)
     - Прочность (через 7 и 28 дней)
     - Влажность
  3. **AI система**:
     - Анализирует исторические данные
     - Предсказывает прочность на основе текущих параметров
     - Выявляет аномалии и рекомендует корректировки
  4. Вводит данные в систему
  5. Устанавливает статус: Одобрено/Отклонено
  6. При отклонении - уведомление технологу

#### Этап 8: Отгрузка и доставка
- **Участники**: Водитель, Логист
- **Процесс**:
  1. Водитель получает маршрутный лист
  2. **IoT GPS** отслеживает местоположение
  3. По прибытии на объект - подтверждение доставки
  4. Заказ закрывается

---

## 2. Цикл производства партии (детально)

### 2.1 Временная диаграмма цикла

```
Время (мин) │
            │
    0       │ [Запланирована] ──────────────────────────────
            │
    1       │ [Дозирование] ────────────────────
            │  ├─ Цемент (30 сек)
            │  ├─ Песок (45 сек)
            │  ├─ Щебень (60 сек)
            │  ├─ Вода (20 сек)
            │  └─ Добавки (10 сек)
            │
    5       │ [Перемешивание] ────────────────────
            │  └─ 2-3 минуты
            │
    8       │ [Выгрузка] ──────────
            │  └─ 1-2 минуты
            │
    10      │ [Завершена] ────────────────────────────────
            │
```

### 2.2 Состояния партии и переходы

```
PLANNED (Запланирована)
    │
    │ Оператор: "Запустить производство"
    ▼
DOSING (Дозирование)
    │
    │ IoT: Все компоненты дозированы
    │ Оператор: "Завершить дозирование"
    ▼
MIXING (Перемешивание)
    │
    │ IoT: Время перемешивания истекло
    │ Система: Автоматический переход
    ▼
DISCHARGING (Выгрузка)
    │
    │ IoT: Бетон выгружен
    │ Система: Автоматический переход
    ▼
COMPLETED (Завершена)
    │
    │ Лаборант: Проверка качества
    ▼
QUALITY_CHECKED (Проверено качество)
```

### 2.3 Параллельные процессы

- **Дозирование следующей партии** может начаться во время перемешивания предыдущей
- **Контроль качества** может проводиться параллельно с производством новых партий
- **Пополнение склада** происходит независимо от производства

---

## 3. Применение IoT (Интернет вещей)

### 3.1 Датчики и оборудование

#### Весовые контроллеры
- **Назначение**: Точное измерение веса компонентов
- **Тип**: Промышленные весы с точностью ±0.1%
- **Интеграция**: 
  - Передача данных в реальном времени
  - Автоматическая остановка при достижении заданного веса
  - Логирование всех взвешиваний

#### Датчики уровня (силосы, бункеры)
- **Типы**: 
  - Ультразвуковые (для сухих материалов)
  - Вибрационные (для сыпучих материалов)
- **Назначение**:
  - Контроль остатков сырья
  - Предупреждение о переполнении
  - Автоматическое планирование закупок
- **Данные**: Уровень заполнения в %, масса в кг

#### Датчики влажности
- **Назначение**: Измерение влажности песка и щебня
- **Тип**: Радиочастотные датчики
- **Применение**:
  - Автоматическая коррекция количества воды в рецепте
  - Формула: `Вода_скорректированная = Вода_рецепт - (Влажность_песка * Песок_кг / 100)`
- **Частота измерений**: Каждые 5 минут

#### Датчики температуры
- **Назначение**: 
  - Температура смеси в процессе перемешивания
  - Температура окружающей среды
- **Применение**:
  - Коррекция времени перемешивания
  - Предупреждение о замерзании зимой

#### Датчики давления и вибрации
- **Назначение**: Мониторинг состояния оборудования
- **Применение**:
  - Предсказательное обслуживание (Predictive Maintenance)
  - Обнаружение аномалий в работе смесителя, конвейеров

#### GPS трекеры (бетоновозы)
- **Назначение**: Отслеживание транспорта
- **Данные**:
  - Текущее местоположение
  - Скорость движения
  - Время в пути
  - Ожидаемое время прибытия

### 3.2 Схема подключения IoT устройств

```
┌─────────────────────────────────────────────────┐
│           ПЛК (Programmable Logic Controller)   │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐     │
│  │ Весы     │  │ Датчики  │  │ Двигатели│     │
│  │ цемента  │  │ уровня   │  │ смесителя│     │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘     │
│       │             │              │            │
│       └─────────────┼──────────────┘            │
│                    │                            │
│              ┌─────▼─────┐                      │
│              │  Шлюз IoT │                      │
│              │  (Gateway)│                      │
│              └─────┬─────┘                      │
└────────────────────┼────────────────────────────┘
                     │
                     │ (MQTT / Modbus / OPC UA)
                     ▼
              ┌──────────────┐
              │  Backend API │
              │  (FastAPI)   │
              └──────┬───────┘
                     │
                     ▼
              ┌──────────────┐
              │   Frontend   │
              │   (React)    │
              └──────────────┘
```

### 3.3 Протоколы связи

- **Modbus RTU/TCP**: Для связи с весовыми контроллерами
- **OPC UA**: Для промышленных контроллеров (Siemens, Schneider)
- **MQTT**: Для IoT датчиков (легковесный протокол)
- **HTTP/REST**: Для интеграции с внешними системами

---

## 4. Применение AI (Искусственный интеллект)

### 4.1 Области применения AI

#### 4.1.1 Предиктивная аналитика качества

**Задача**: Предсказание прочности бетона на основе параметров производства

**Модель**: Регрессионная модель (Random Forest / Neural Network)

**Входные данные**:
- Состав рецепта (цемент, песок, щебень, вода, добавки)
- Фактическое дозирование
- Влажность инертных материалов
- Температура смеси
- Время перемешивания
- Исторические данные (1000+ партий)

**Выходные данные**:
- Предсказанная прочность через 7 дней
- Предсказанная прочность через 28 дней
- Вероятность соответствия ГОСТ
- Рекомендации по корректировке

**Применение**:
- Раннее обнаружение проблемных партий
- Оптимизация рецептур
- Снижение брака

#### 4.1.2 Оптимизация рецептур

**Задача**: Найти оптимальный состав бетона для заданной прочности с минимальной стоимостью

**Модель**: Оптимизационный алгоритм (Genetic Algorithm / Gradient Descent)

**Ограничения**:
- Минимальная/максимальная прочность
- Соответствие ГОСТ
- Доступность сырья
- Стоимость компонентов

**Результат**: Рекомендуемый состав рецепта

#### 4.1.3 Предсказательное обслуживание (Predictive Maintenance)

**Задача**: Предсказать отказ оборудования до его возникновения

**Модель**: Временные ряды (LSTM) + Anomaly Detection

**Входные данные**:
- Вибрация двигателей
- Температура подшипников
- Энергопотребление
- Частота использования
- История отказов

**Выходные данные**:
- Вероятность отказа в ближайшие 7/30 дней
- Рекомендации по обслуживанию
- Оптимальное время для ремонта

**Экономический эффект**:
- Снижение простоев на 30-40%
- Оптимизация расходов на обслуживание
- Предотвращение аварий

#### 4.1.4 Оптимизация производства

**Задача**: Оптимизировать последовательность заказов для минимизации простоев

**Модель**: Алгоритм планирования (Constraint Programming)

**Факторы**:
- Приоритет заказов
- Время доставки
- Доступность транспорта
- Загруженность оборудования
- Остатки сырья

**Результат**: Оптимальная последовательность производства

#### 4.1.5 Автоматическая коррекция дозирования

**Задача**: Автоматически корректировать количество воды с учетом влажности

**Модель**: Правила + Машинное обучение

**Алгоритм**:
```python
# Базовая формула
water_corrected = water_recipe - (moisture_sand * sand_kg / 100) - (moisture_gravel * gravel_kg / 100)

# AI коррекция на основе исторических данных
if historical_deviation > threshold:
    water_corrected += ai_correction_factor
```

#### 4.1.6 Обнаружение аномалий

**Задача**: Обнаружить отклонения в процессе производства в реальном времени

**Модель**: Isolation Forest / Autoencoder

**Мониторинг**:
- Отклонения дозирования
- Аномальное энергопотребление
- Необычные значения температуры
- Отклонения во времени цикла

**Действия**:
- Автоматическое предупреждение оператора
- Остановка процесса при критических аномалиях
- Логирование для анализа

#### 4.1.7 Прогнозирование спроса

**Задача**: Предсказать спрос на бетон для планирования закупок сырья

**Модель**: Временные ряды (Prophet / ARIMA)

**Факторы**:
- Сезонность (строительный сезон)
- День недели
- Погодные условия
- Экономические индикаторы
- История заказов

**Применение**:
- Планирование закупок цемента
- Оптимизация складских запасов
- Планирование производства

### 4.2 Архитектура AI системы

```
┌─────────────────────────────────────────────────┐
│           Сбор данных (IoT + Manual)            │
└───────────────────┬─────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────┐
│         Хранилище данных (TimescaleDB)         │
│  - Исторические данные партий                   │
│  - Данные с датчиков                            │
│  - Результаты лабораторных испытаний            │
└───────────────────┬─────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────┐
│         ML Pipeline (Python)                    │
│  - Обучение моделей                              │
│  - Валидация                                     │
│  - Деплой                                        │
└───────────────────┬─────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────┐
│         AI Service (FastAPI)                    │
│  - Предсказания в реальном времени               │
│  - Рекомендации                                  │
│  - Обнаружение аномалий                          │
└───────────────────┬─────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────┐
│         Frontend (React)                        │
│  - Визуализация предсказаний                    │
│  - Рекомендации оператору                       │
│  - Алерты                                        │
└─────────────────────────────────────────────────┘
```

### 4.3 Примеры использования AI в интерфейсе

1. **При создании партии**: AI показывает предсказанную прочность
2. **Во время дозирования**: AI рекомендует корректировку воды
3. **После перемешивания**: AI оценивает качество на основе параметров
4. **В лаборатории**: AI предсказывает прочность до испытаний
5. **На дашборде**: AI показывает прогноз производства на день

---

## 5. Интеграции

### 5.1 ERP/1C
- **Обмен данными**:
  - Заказы из ERP → АСУ ТП
  - Партии из АСУ ТП → ERP
  - Остатки сырья → ERP
  - Списание материалов → ERP
- **Протокол**: REST API / XML / JSON

### 5.2 CRM
- **Данные**: Заказы, клиенты, история
- **Синхронизация**: Двусторонняя

### 5.3 Мобильное приложение водителей
- **Функции**:
  - Получение маршрутных листов
  - Подтверждение доставки
  - Фото доставки
  - GPS трекинг

---

## 6. Безопасность и надежность

### 6.1 Отказоустойчивость
- Резервное копирование данных каждые 6 часов
- Автоматическое восстановление после сбоя
- Ручной режим работы оборудования
- Локальное кэширование рецептов

### 6.2 Безопасность
- Ролевой доступ
- Логирование всех действий
- Шифрование данных
- Резервные копии БД

---

## 7. Метрики эффективности

- **Точность дозирования**: >98% в пределах допусков
- **Время цикла**: 8-12 минут на партию
- **Производительность**: До 50 партий в смену
- **Брак**: <1% от общего объема
- **Простои оборудования**: <5% рабочего времени

