# Архитектура системы

## Общая архитектура

```
┌─────────────────────────────────────────────────────────────┐
│                        FRONTEND                              │
│  React + TypeScript + Vite + TailwindCSS                    │
│  - UI компоненты                                             │
│  - Управление состоянием (Zustand)                           │
│  - API клиент (Axios)                                        │
│  - Роутинг (React Router)                                    │
└───────────────────────┬─────────────────────────────────────┘
                        │ HTTP/REST
                        ▼
┌─────────────────────────────────────────────────────────────┐
│                        BACKEND                                │
│  Python + FastAPI + SQLAlchemy                               │
│  - REST API endpoints                                         │
│  - Бизнес-логика                                              │
│  - Валидация данных (Pydantic)                                │
│  - Аутентификация (JWT)                                       │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────┐
│                    DATABASE                                   │
│  SQLite (dev) / PostgreSQL (prod)                            │
│  - Модели данных (SQLAlchemy ORM)                            │
│  - Миграции (Alembic)                                        │
└─────────────────────────────────────────────────────────────┘
```

## Структура данных

### Основные сущности

1. **User** - Пользователи системы
2. **Recipe** - Рецептуры бетона
3. **Order** - Заказы на производство
4. **Batch** - Производственные партии
5. **DosingLog** - Логи дозирования
6. **QualityCheck** - Проверки качества
7. **WarehouseMaterial** - Склад сырья
8. **EquipmentStatus** - Статус оборудования

### Связи между сущностями

```
Order (1) ──→ (N) Batch
Batch (N) ──→ (1) Recipe
Batch (1) ──→ (1) QualityCheck
Batch (1) ──→ (N) DosingLog
User (1) ──→ (N) Order
User (1) ──→ (N) QualityCheck
```

## Поток данных

### Создание и выполнение заказа

1. **Логист** создает Order через API
2. **Оператор** создает Batch из Order
3. **Оператор** запускает производство (Batch → DOSING)
4. **IoT датчики** передают данные дозирования
5. **Оператор** завершает дозирование (Batch → MIXING)
6. **Система** автоматически переводит в DISCHARGING
7. **Система** автоматически завершает (Batch → COMPLETED)
8. **Лаборант** создает QualityCheck
9. **Система** обновляет статус заказа

## Безопасность

- JWT токены для аутентификации
- Ролевой доступ (RBAC)
- Валидация всех входных данных
- SQL injection защита (ORM)
- CORS настройки
- Хеширование паролей (pbkdf2_sha256)

## Масштабируемость

- Stateless API (можно горизонтально масштабировать)
- Кэширование на уровне фронтенда
- Возможность добавления Redis для кэширования
- TimescaleDB для временных рядов (IoT данные)

